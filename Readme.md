# 保险柜设计方案

## 解决哪些问题?



* **数据隔离问题**

  业务系统数据库,不存储敏感信息,只保存脱敏后的数据

* **脱敏后如何获得原始数据**

  业务系统只保存脱敏信息及对应敏感信息的要是,即secretKey, secretKey需要保证随机性,抗暴力破解,可使用UUID或者雪花算法生成的ID,建议使用后者.业务系统保存secretKey,需要获取敏感信息时,通过secretKey来获取.

  Dubbo接口: dubbo接口线上环境无法通过本地访问,可以屏蔽数据泄露(在线上环境的ecs挂马除外)

  http接口: 通过http接口需要使用token,获取token需要使用账号密码,除非账号密码泄露.

* **如何通过原始信息的关键字进行检索,比如手机尾号**

  方案一: 业务系统冗余敏感信息的关键字供查询

  方案二: 保险柜服务在保存敏感信息时,解析出关键字,冗余存储,注意解析关键字算法需是单向函数

* **如果账号密码泄露怎么办**

  敏感信息统一收口后,可以对某一用户,某敏感信息类型,在指定时间内的访问频次做控制及预警.

* **如何对现有敏感数据做脱敏**

  保险箱服务,可以针对指定数据源,指定schema,指定表的指定字段进行脱敏,并将脱敏数据,secretKey,或者敏感信息关键字回写到业务表中,数据脱敏完成后,只需要删除原敏感信息字段,业务代码展示脱敏后的字段即可.

* **新生成的数据如何脱敏**

  新生成的数据,在保存到数据库之前,需要在保险柜服务配置敏感信息类型,脱敏方式等.

  如果是前端录入: 首选由前段调用保险柜http服务对数据进行脱敏,获取脱敏后的数据,secretKey,用于检索的关键字等,然后提交给后端业务系统.

  如果是后端系统同步: 例如淘宝订单同步,比如outway,在收取到订单信息时,调用保险柜服务,将敏感信息脱敏,获取脱敏数据后,再进行其他处理.

* **如何防止DBA泄露敏感信息**

  存储在数据库中的敏感信息,使用对称加密算法进行加密,加密代码仅开发人员可见.(无法避免协同作案)

* **敏感信息类别针对角色开放**



<font size=5 color='red'>**没有绝对安全,只有相对安全!**</font>



## 设计方案

* **业务模型**

  ![image-20210305205038474](https://tva1.sinaimg.cn/large/008eGmZEly1go9bk5u6opj30q70ghtas.jpg)

* **系统交互时序**

  * 新数据脱敏-前端录入

    ![image-20210305204417660](https://tva1.sinaimg.cn/large/008eGmZEly1go9bdk16cvj30oi0bwwf0.jpg)

  * 新数据脱敏-后端同步

    ![image-20210305204524796](https://tva1.sinaimg.cn/large/008eGmZEly1go9beq4kolj30tu0gc754.jpg)

  * 前端使用敏感数据

    ![image-20210305205115176](https://tva1.sinaimg.cn/large/008eGmZEly1go9bkt9sy9j311v0kpmyv.jpg)

  * 后端使用敏感信息

    ![image-20210316161113560](https://tva1.sinaimg.cn/large/e6c9d24ely1goltau44vcj21jm0sgwgt.jpg)

    <font color='red'>**注意:禁止后端系统直接提供敏感信息给前端,前端获取敏感信息只能直接通过保险柜服务获取**</font>

  * 通过敏感信息关键字检索业务数据

    ![image-20210305210626622](https://tva1.sinaimg.cn/large/008eGmZEly1go9c0m2hu3j30ta0hogmx.jpg)

* 历史数据脱敏

  * 配置敏感信息类别

  * 配置历史敏感数据脱敏任务

    ![image-20210305212315649](https://tva1.sinaimg.cn/large/008eGmZEly1go9ci3xrunj30b80ab757.jpg)

  * 启动脱敏任务

    ![image-20210305212626437](https://tva1.sinaimg.cn/large/008eGmZEly1go9clfbpsbj30ye0n7jt4.jpg)

  * 监控处理进度

    通过比对原始数据和处理后的数据的数量即可(id唯一)

  * DBA将目标表的数据更新到原始表

  * 业务系统应用兼容新的表模型

  * 前段扩展查看敏感信息能力